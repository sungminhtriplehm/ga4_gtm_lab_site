<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GA4 + GTM Lab | Button Tracking</title>
  <link rel="stylesheet" href="assets/style.css" />
  <script>
    window.dataLayer = window.dataLayer || [];
  </script>
  <script src="assets/gtm-head-bootstrap.js"></script>
  <!-- GTM_HEAD_SLOT -->
</head>
<body>
  <!-- GTM_BODY_SLOT -->

  <header class="site-header">
    <div class="container topbar">
      <a class="brand" href="index.html">GA4 + GTM Static Lab Shop</a>
      <div class="top-controls">
        <span class="mode-chip">Tracking: <strong data-current-mode>standard</strong></span>
        <a class="cart-link" href="cart.html">Cart <span class="badge" data-cart-count>0</span></a>
      </div>
    </div>
    <nav class="container page-nav">
      <a href="index.html" data-nav-page="index">Home</a>
      <a href="product-sku-001.html" data-nav-page="product">Product</a>
      <a href="cart.html" data-nav-page="cart">Cart</a>
      <a href="checkout.html" data-nav-page="checkout">Checkout</a>
      <a href="thankyou.html" data-nav-page="thankyou">Thankyou</a>
      <a href="form.html" data-nav-page="form">Lead Form</a>
      <a href="buttons.html" data-nav-page="buttons">Buttons</a>
      <a href="builder.html" data-nav-page="builder">Platform Ref</a>
      <a href="gtm-setup.html" data-nav-page="gtm-setup">GTM Setup</a>
    </nav>
  </header>

  <main class="container">
    <section class="panel">
      <h1 class="page-title">버튼 추적 실습</h1>
      <p class="small">
        아래 버튼은 id/data-attribute가 고정되어 있습니다. GTM Click Trigger 조건을 바로 실습할 수 있습니다.
      </p>
    </section>

    <section class="layout-grid" style="margin-top:14px;">
      <div class="trigger-row">
        <button id="btnCtaPrimary" class="btn" data-track-type="cta" type="button">CTA Primary</button>
        <div class="small">추천 트리거: Click ID equals <code>btnCtaPrimary</code></div>
      </div>
      <div class="trigger-row">
        <button id="btnCtaSecondary" class="btn secondary" data-track-type="cta" type="button">CTA Secondary</button>
        <div class="small">추천 트리거: Click ID equals <code>btnCtaSecondary</code></div>
      </div>
      <div class="trigger-row">
        <a id="btnCall" class="btn secondary" href="tel:+820212345678" data-track-type="call">전화 연결</a>
        <div class="small">추천 트리거: Click ID equals <code>btnCall</code></div>
      </div>
      <div class="trigger-row">
        <a id="btnDownload" class="btn secondary" download="lab-guide.txt" href="data:text/plain;charset=utf-8,GA4%20GTM%20lab%20download%20sample" data-track-type="download">파일 다운로드</a>
        <div class="small">추천 트리거: Click ID equals <code>btnDownload</code></div>
      </div>
      <div class="trigger-row">
        <a id="btnExternal" class="btn secondary" href="https://example.com" target="_blank" rel="noopener" data-track-type="outbound">외부 링크</a>
        <div class="small">추천 트리거: Click ID equals <code>btnExternal</code></div>
      </div>
      <div class="trigger-row">
        <button id="btnOpenModal" class="btn accent" type="button" data-track-type="modal">모달 열기</button>
        <div class="small">추천 트리거: Click ID equals <code>btnOpenModal</code></div>
      </div>
    </section>

    <section class="panel" style="margin-top:14px;">
      <h2 class="page-title">실시간 버튼 이벤트 로그</h2>
      <p id="buttonEventStatus" class="small">버튼을 클릭하면 이 영역에 즉시 이벤트 결과가 표시됩니다.</p>
      <pre id="buttonEventLog">[]</pre>
    </section>
  </main>

  <div id="buttonModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal">
      <h3>버튼 실습 모달</h3>
      <p class="small">모달 오픈/클로즈 클릭을 별도 이벤트로 추적할 수 있습니다.</p>
      <div class="btn-row">
        <button id="btnCloseButtonModal" class="btn secondary" type="button">닫기</button>
      </div>
    </div>
  </div>

  <script src="assets/data.js"></script>
  <script src="assets/app.js"></script>
  <script>
    LAB.initCommon("buttons");

    var modal = document.getElementById("buttonModal");
    var statusEl = document.getElementById("buttonEventStatus");
    var logEl = document.getElementById("buttonEventLog");
    var eventLog = [];

    function renderLog() {
      logEl.textContent = JSON.stringify(eventLog, null, 2);
    }

    function logButtonEvent(eventName, params) {
      var payload = params || {};
      try {
        LAB.pushEvent(eventName, payload);
        statusEl.textContent = "전송 성공: " + eventName + " (" + (payload.button_id || "unknown") + ")";
      } catch (err) {
        statusEl.textContent = "전송 실패: " + eventName + " (" + err.message + ")";
      }

      eventLog.unshift({
        at: new Date().toISOString(),
        event: eventName,
        params: payload
      });
      if (eventLog.length > 30) {
        eventLog = eventLog.slice(0, 30);
      }
      renderLog();
    }

    document.getElementById("btnCtaPrimary").addEventListener("click", function () {
      logButtonEvent("cta_click", {
        button_id: "btnCtaPrimary",
        button_label: "CTA Primary",
        button_type: "cta"
      });
    });

    document.getElementById("btnCtaSecondary").addEventListener("click", function () {
      logButtonEvent("cta_click", {
        button_id: "btnCtaSecondary",
        button_label: "CTA Secondary",
        button_type: "cta"
      });
    });

    document.getElementById("btnCall").addEventListener("click", function (event) {
      event.preventDefault();
      var href = this.getAttribute("href");
      logButtonEvent("phone_click", {
        button_id: "btnCall",
        button_label: "전화 연결",
        button_type: "call",
        link_url: href
      });
      window.location.href = href;
    });

    document.getElementById("btnDownload").addEventListener("click", function (event) {
      event.preventDefault();
      var href = this.getAttribute("href");
      var filename = this.getAttribute("download") || "download.txt";
      logButtonEvent("file_download_click", {
        button_id: "btnDownload",
        button_label: "파일 다운로드",
        button_type: "download",
        file_name: filename
      });
      var tempLink = document.createElement("a");
      tempLink.href = href;
      tempLink.download = filename;
      document.body.appendChild(tempLink);
      tempLink.click();
      document.body.removeChild(tempLink);
    });

    document.getElementById("btnExternal").addEventListener("click", function (event) {
      event.preventDefault();
      var href = this.getAttribute("href");
      logButtonEvent("outbound_click", {
        button_id: "btnExternal",
        button_label: "외부 링크",
        button_type: "outbound",
        link_url: href
      });
      window.open(href, "_blank", "noopener");
    });

    document.getElementById("btnOpenModal").addEventListener("click", function () {
      logButtonEvent("modal_open", {
        button_id: "btnOpenModal",
        button_label: "모달 열기",
        button_type: "modal"
      });
      modal.classList.add("open");
      modal.setAttribute("aria-hidden", "false");
    });

    document.getElementById("btnCloseButtonModal").addEventListener("click", function () {
      logButtonEvent("modal_close", {
        button_id: "btnCloseButtonModal",
        button_label: "모달 닫기",
        button_type: "modal"
      });
      modal.classList.remove("open");
      modal.setAttribute("aria-hidden", "true");
    });

    renderLog();
  </script>
</body>
</html>





