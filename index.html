<!doctype html>
<html lang="ko">
<head>
  <title>Lab Shop | Home</title>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/style.css" />
  <script>
    // dataLayerëŠ” GTMì´ ë¡œë“œë˜ê¸° ì „ì— ë¨¼ì € ì„ ì–¸í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.
    window.dataLayer = window.dataLayer || [];
  </script>

  <!-- GTM HEAD SNIPPET: Google Tag Managerì—ì„œ ë³µì‚¬í•œ <script>...</script>ë¥¼ ì—¬ê¸° ë¶™ì—¬ë„£ìœ¼ì„¸ìš” -->
   
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-TTWSJGDJ');</script>
  <!-- End Google Tag Manager -->

</head>
<body>

  <!-- GTM BODY SNIPPET: Google Tag Managerì—ì„œ ë³µì‚¬í•œ <noscript>...</noscript>ë¥¼ ì—¬ê¸° ë¶™ì—¬ë„£ìœ¼ì„¸ìš” -->

<header class="container">
  <a class="brand" href="index.html" aria-label="Home">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>GTM + GA4 ì „ììƒê±°ë˜ ì‹¤ìŠµ ë¯¸ë‹ˆìƒµ</h1>
      <div class="small">ì •ì  í˜ì´ì§€( GitHub Pages ) + dataLayer ê¸°ë°˜ ì´ë²¤íŠ¸</div>
    </div>
  </a>

  <nav class="nav">
    <div class="pill">
      <label style="display:flex; align-items:center; gap:8px;">
        <input type="checkbox" data-member-toggle />
        <span data-member-label>íšŒì›ê°€ OFF</span>
      </label>
    </div>

    <a class="pill" href="cart.html">
      ğŸ›’ ì¥ë°”êµ¬ë‹ˆ
      <span class="badge" data-cart-count>0</span>
    </a>
  </nav>
</header>

<main class="container">
  <section class="hero">
    <div>
      <h2>í•™ìŠµ ëª©í‘œ</h2>
      <p>
        <b>ë©”ì¸ â†’ ìƒì„¸ â†’ ì¥ë°”êµ¬ë‹ˆ â†’ ì²´í¬ì•„ì›ƒ â†’ êµ¬ë§¤ì™„ë£Œ</b> íë¦„ì„ ì§ì ‘ ë§Œë“¤ê³ ,
        GA4/GTMì—ì„œ <span class="inline code">view_item_list</span>, <span class="inline code">select_item</span>,
        <span class="inline code">view_item</span>, <span class="inline code">add_to_cart</span>,
        <span class="inline code">begin_checkout</span>, <span class="inline code">purchase</span> ë“±ì„ ì‹¤ìŠµí•©ë‹ˆë‹¤.
      </p>
    </div>
    <div class="kpi">
      <div class="box">
        <div class="label">íšŒì›ê°€ ìƒíƒœ</div>
        <div class="value" id="memberState">OFF</div>
      </div>
      <div class="box">
        <div class="label">í…ŒìŠ¤íŠ¸ íŒ</div>
        <div class="value">GTM Preview + GA4 DebugView</div>
      </div>
    </div>
  </section>

  <section class="grid" id="productList" aria-label="Product list"></section>
</main>

<footer class="container">
  <div>
    ì´ í˜ì´ì§€ëŠ” GA4/GTM ì‹¤ìŠµìš© ê°€ì§œ ìŠ¤í† ì–´ì…ë‹ˆë‹¤. ì‹¤ì œ ê²°ì œ/íšŒì›/ê°œì¸ì •ë³´ ìˆ˜ì§‘ì€ ì—†ìŠµë‹ˆë‹¤.
  </div>
  <div class="small">
    íŒ) ë¸Œë¼ìš°ì € ê´‘ê³  ì°¨ë‹¨ í™•ì¥í”„ë¡œê·¸ë¨ì´ GA/GTM ìš”ì²­ì„ ë§‰ì„ ìˆ˜ ìˆì–´ìš”. í…ŒìŠ¤íŠ¸ ì¤‘ì—” ì ì‹œ êº¼ë³´ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤.
  </div>
</footer>

<script src="assets/shop.js"></script>
<script>
  const LIST_ID = "home_list";
  const LIST_NAME = "Home Product List";

  function renderProducts() {
    setMemberToggleUI();
    updateCartBadge();

    document.getElementById("memberState").textContent = isMember() ? "ON" : "OFF";

    const listEl = document.getElementById("productList");
    listEl.innerHTML = "";

    const itemsForEvent = [];

    CATALOG.forEach((p, idx) => {
      const { item, price_type } = buildItem(p, 1, {
        item_list_id: LIST_ID,
        item_list_name: LIST_NAME,
        index: idx
      });

      itemsForEvent.push(item);

      const card = document.createElement("article");
      card.className = "card";

      const priceText = `${formatKRW(item.price)}ì›`;
      const discountText = item.discount ? `í• ì¸ -${formatKRW(item.discount)}ì›` : "í• ì¸ ì—†ìŒ";

      const href = `product.html?sku=${encodeURIComponent(p.item_id)}&list_id=${encodeURIComponent(LIST_ID)}&list_name=${encodeURIComponent(LIST_NAME)}&index=${idx}`;

      card.innerHTML = `
        <h3>${p.item_name}</h3>
        <div class="meta">
          <span>ì¹´í…Œê³ ë¦¬: ${p.item_category}</span>
          <span>SKU: <code class="inline">${p.item_id}</code></span>
          <span>price_type: <code class="inline">${price_type}</code></span>
        </div>
        <div class="price">
          <strong>${priceText}</strong>
          <span>${discountText}</span>
        </div>
        <div class="row">
          <a class="btn" href="${href}">ìƒì„¸ ë³´ê¸°</a>
          <button class="btn secondary" data-quick-add>ë°”ë¡œ ë‹´ê¸°</button>
        </div>
        <div class="small">
          ë©”ì¸ì—ì„œ ìƒí’ˆì´ ë…¸ì¶œë˜ë©´ <code class="inline">view_item_list</code>ë¥¼ 1íšŒ ì „ì†¡í•©ë‹ˆë‹¤.
        </div>
      `;

      // Quick add: add_to_cart
      card.querySelector("[data-quick-add]").addEventListener("click", () => {
        const qty = 1;
        const { item: cartItem, price_type: pt } = buildItem(p, qty);
        addToCart(cartItem);

        pushEcomEvent("add_to_cart", {
          currency: CURRENCY,
          value: calcValue([cartItem]),
          price_type: pt,
          ecommerce: { items: [cartItem] }
        });

        alert("ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤. (add_to_cart ì „ì†¡)");
      });

      listEl.appendChild(card);
    });

    // view_item_list (ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ë…¸ì¶œ)
    pushEcomEvent("view_item_list", {
      item_list_id: LIST_ID,
      item_list_name: LIST_NAME,
      price_type: isMember() ? "member" : "regular",
      ecommerce: { items: itemsForEvent }
    });
  }

  bindMemberToggle(renderProducts);
  renderProducts();
</script>
</body>
</html>
